# 📊 留言管理后台使用指南

## 🚀 快速开始

### 1. 启动后端服务

```bash
# 确保虚拟环境已激活
source venv/bin/activate.fish

# 启动 FastAPI 服务
python main.py
```

服务将在 http://localhost:8000 运行

### 2. 打开管理后台

在浏览器中打开 `admin.html` 文件：

```bash
# 方法 1：直接用浏览器打开
open admin.html

# 方法 2：使用 Python 简单服务器（推荐）
python -m http.server 8080
# 然后访问 http://localhost:8080/admin.html
```

## ✨ 功能介绍

### 📈 数据统计
管理后台顶部显示四个统计卡片：
- **总留言数**：数据库中所有留言的总数
- **实名留言**：非匿名留言的数量
- **匿名留言**：匿名留言的数量
- **今日新增**：当天新增的留言数量

### 🔍 搜索功能
在搜索框中输入关键词，可实时搜索：
- 留言内容
- 用户名

### ➕ 新增留言
1. 点击 **"➕ 新增留言"** 按钮
2. 填写表单：
   - 用户名（必填）
   - 留言内容（必填）
   - 是否匿名（可选）
3. 点击 **"保存"** 按钮

### ✏️ 编辑留言
1. 在表格中找到要编辑的留言
2. 点击 **"✏️ 编辑"** 按钮
3. 在弹出的对话框中修改内容
4. 点击 **"保存"** 按钮

### 🗑️ 删除留言
1. 在表格中找到要删除的留言
2. 点击 **"🗑️ 删除"** 按钮
3. 确认删除操作

### 🔄 刷新数据
点击 **"🔄 刷新数据"** 按钮，重新从服务器加载最新数据

### 📥 导出数据
点击 **"📥 导出数据"** 按钮，将所有留言导出为 CSV 文件：
- 文件名格式：`留言数据_YYYY-MM-DD.csv`
- 包含字段：ID、用户名、类型、留言内容、创建时间
- 支持中文（UTF-8 with BOM）

## 🎨 界面特点

### 🌈 美观设计
- 渐变色背景（紫色系）
- 卡片式布局
- 圆角设计
- 悬浮动画效果

### 📱 响应式布局
- 适配桌面端和移动端
- 表格支持横向滚动
- 自适应网格布局

### 🎯 用户体验
- 实时搜索过滤
- 操作成功/失败提示（Toast 通知）
- 确认删除对话框
- 加载状态显示
- 空状态提示

## 🔧 技术栈

- **前端**：纯 HTML + CSS + JavaScript（无需框架）
- **后端 API**：FastAPI
- **样式**：原生 CSS（无需额外依赖）
- **图标**：Emoji（零依赖）

## 📡 API 接口说明

管理后台调用以下 API：

### 获取所有留言
```
GET /get_comments
```

### 创建新留言
```
POST /post_comment
Content-Type: application/json

{
  "username": "用户名",
  "content": "留言内容",
  "isAnonymous": false
}
```

### 更新留言
```
PUT /update_comment/{comment_id}
Content-Type: application/json

{
  "username": "用户名",
  "content": "留言内容",
  "isAnonymous": false
}
```

### 删除留言
```
DELETE /delete_comment/{comment_id}
```

## ⚙️ 配置说明

### 修改 API 地址

如果后端服务不在 `localhost:8000`，需要修改 `admin.html` 中的 API 地址：

```javascript
const API_BASE = 'http://localhost:8000';  // 修改为你的后端地址
```

### 跨域问题

后端已配置 CORS 允许所有源访问：

```python
app.add_middleware(
    CORSMiddleware,
    allow_origins=["*"],  # 生产环境建议指定具体域名
    allow_credentials=True,
    allow_methods=["*"],
    allow_headers=["*"],
)
```

## 🐛 常见问题

### Q: 打开页面后显示"加载失败"？
**A**: 请确保：
1. 后端服务已启动（`python main.py`）
2. 后端地址正确（默认 `http://localhost:8000`）
3. 浏览器控制台查看具体错误信息

### Q: 无法添加/编辑/删除留言？
**A**: 检查：
1. 后端服务是否正常运行
2. 浏览器控制台是否有跨域错误
3. 数据库文件 `comments.db` 是否存在且可写

### Q: 导出的 CSV 文件中文乱码？
**A**: 使用 Excel 打开 CSV：
1. 使用"导入数据"功能而不是直接打开
2. 或使用 Google Sheets / WPS 等工具打开（通常自动识别编码）

### Q: 页面样式错乱？
**A**: 建议使用现代浏览器：
- Chrome / Edge（推荐）
- Firefox
- Safari

### Q: 移动端如何访问？
**A**: 
1. 确保手机和电脑在同一网络
2. 修改后端启动地址为 `0.0.0.0`
3. 使用电脑 IP 地址访问，如 `http://192.168.1.100:8080/admin.html`

## 📸 功能截图

### 主界面
- 顶部统计卡片显示数据概览
- 控制栏提供快捷操作
- 表格展示所有留言详情

### 新增/编辑对话框
- 简洁的表单设计
- 实时验证必填项
- 匿名选项勾选

### 操作提示
- 成功：绿色边框提示
- 失败：红色边框提示
- 自动 3 秒后消失

## 🎯 后续优化建议

- [ ] 添加用户登录认证
- [ ] 添加分页功能（当数据量大时）
- [ ] 添加批量删除功能
- [ ] 添加数据排序功能
- [ ] 添加留言审核功能
- [ ] 添加数据图表展示
- [ ] 支持导出 Excel 格式
- [ ] 添加操作日志记录

## 📞 技术支持

如有问题，请检查：
1. 后端服务日志
2. 浏览器控制台错误信息
3. 数据库文件权限

---

**Enjoy! 🎉**
